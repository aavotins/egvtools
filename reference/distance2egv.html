<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Distance-to-class on the EGV grid — distance2egv • egvtools</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Distance-to-class on the EGV grid — distance2egv"><meta name="description" content="Computes Euclidean distance (in map units) from cells matching a set of
class values in an input raster to all cells of an EGV template grid,
then writes a Float32 GeoTIFF aligned to the template. Designed to work with
rasters produced by polygon2input()."><meta property="og:description" content="Computes Euclidean distance (in map units) from cells matching a set of
class values in an input raster to all cells of an EGV template grid,
then writes a Float32 GeoTIFF aligned to the template. Designed to work with
rasters produced by polygon2input()."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">egvtools</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/aavotins/egvtools" aria-label="GitHub repository"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Distance-to-class on the EGV grid</h1>
      <small class="dont-index">Source: <a href="https://github.com/aavotins/egvtools/blob/HEAD/R/distance2egv.R" class="external-link"><code>R/distance2egv.R</code></a></small>
      <div class="d-none name"><code>distance2egv.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Computes Euclidean distance (in <strong>map units</strong>) from cells matching a set of
class values in an <strong>input raster</strong> to all cells of an <strong>EGV template</strong> grid,
then writes a Float32 GeoTIFF aligned to the template. Designed to work with
rasters produced by <code><a href="polygon2input.html">polygon2input()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">distance2egv</span><span class="op">(</span></span>
<span>  <span class="va">input</span>,</span>
<span>  <span class="va">template_egv</span>,</span>
<span>  values_as_one <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  project_to_template_input <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  template_input <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_whitebox <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  fill_gaps <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  idw_weight <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  filter_size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  outlocation <span class="op">=</span> <span class="st">"./Rastri_100m/RAW/"</span>,</span>
<span>  <span class="va">outfilename</span>,</span>
<span>  <span class="va">layername</span>,</span>
<span>  check_na <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plot_result <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plot_gaps <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  NAflag <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  gdal_opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"TILED=YES"</span>, <span class="st">"BIGTIFF=IF_SAFER"</span>, <span class="st">"NUM_THREADS=ALL_CPUS"</span>,</span>
<span>    <span class="st">"BLOCKXSIZE=256"</span>, <span class="st">"BLOCKYSIZE=256"</span><span class="op">)</span>,</span>
<span>  write_datatype <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  terra_memfrac <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  terra_tempdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  terra_todisk <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  force_gc <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-input">input<a class="anchor" aria-label="anchor" href="#arg-input"></a></dt>
<dd><p><code><a href="https://rspatial.github.io/terra/reference/SpatRaster-class.html" class="external-link">terra::SpatRaster</a></code> or file path. Raster prepared by <code><a href="polygon2input.html">polygon2input()</a></code>.</p></dd>


<dt id="arg-template-egv">template_egv<a class="anchor" aria-label="anchor" href="#arg-template-egv"></a></dt>
<dd><p><code><a href="https://rspatial.github.io/terra/reference/SpatRaster-class.html" class="external-link">terra::SpatRaster</a></code> or path. Target EGV template (e.g., 100 m).</p></dd>


<dt id="arg-values-as-one">values_as_one<a class="anchor" aria-label="anchor" href="#arg-values-as-one"></a></dt>
<dd><p><code>NULL</code>, numeric vector, and/or range strings in bracket
notation (see Details). If <code>NULL</code>, non-<code>NA</code> cells are sources.</p></dd>


<dt id="arg-project-to-template-input">project_to_template_input<a class="anchor" aria-label="anchor" href="#arg-project-to-template-input"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, reproject <code>input</code> to
<code>template_input</code> <strong>once at the start</strong>. Default <code>FALSE</code>.</p></dd>


<dt id="arg-template-input">template_input<a class="anchor" aria-label="anchor" href="#arg-template-input"></a></dt>
<dd><p>When <code>project_to_template_input=TRUE</code>, a 10 m template
used to define the target CRS/grid for that initial reprojection.</p></dd>


<dt id="arg-use-whitebox">use_whitebox<a class="anchor" aria-label="anchor" href="#arg-use-whitebox"></a></dt>
<dd><p>Logical; use Whitebox for distance (default <code>TRUE</code>),
otherwise <code><a href="https://rspatial.github.io/terra/reference/distance.html" class="external-link">terra::distance()</a></code>.</p></dd>


<dt id="arg-fill-gaps">fill_gaps<a class="anchor" aria-label="anchor" href="#arg-fill-gaps"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, fill remaining gaps on the <strong>template grid</strong>
using Whitebox <code>wbt_fill_missing_data()</code>. Default <code>FALSE</code>.</p></dd>


<dt id="arg-idw-weight">idw_weight<a class="anchor" aria-label="anchor" href="#arg-idw-weight"></a></dt>
<dd><p>IDW power for Whitebox fill. Default <code>2</code>.</p></dd>


<dt id="arg-filter-size">filter_size<a class="anchor" aria-label="anchor" href="#arg-filter-size"></a></dt>
<dd><p>Optional odd integer window for Whitebox. If <code>NULL</code>, auto:
<code>2 * max_gap_width_cells</code>, with a <strong>minimum of 3</strong>.</p></dd>


<dt id="arg-outlocation">outlocation<a class="anchor" aria-label="anchor" href="#arg-outlocation"></a></dt>
<dd><p>Output directory. Default <code>"./Rastri_100m/RAW/"</code>.</p></dd>


<dt id="arg-outfilename">outfilename<a class="anchor" aria-label="anchor" href="#arg-outfilename"></a></dt>
<dd><p>Output filename (e.g., <code>"dist_class_100m.tif"</code>). <strong>Required</strong>.</p></dd>


<dt id="arg-layername">layername<a class="anchor" aria-label="anchor" href="#arg-layername"></a></dt>
<dd><p>Output band name. <strong>Required</strong>.</p></dd>


<dt id="arg-check-na">check_na<a class="anchor" aria-label="anchor" href="#arg-check-na"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, report internal NA count on the template footprint. Default <code>FALSE</code>.</p></dd>


<dt id="arg-plot-result">plot_result<a class="anchor" aria-label="anchor" href="#arg-plot-result"></a></dt>
<dd><p>Logical; plot final result.</p></dd>


<dt id="arg-plot-gaps">plot_gaps<a class="anchor" aria-label="anchor" href="#arg-plot-gaps"></a></dt>
<dd><p>Logical; plot gap map (TRUE = gap). If both TRUE, side-by-side.</p></dd>


<dt id="arg-naflag">NAflag<a class="anchor" aria-label="anchor" href="#arg-naflag"></a></dt>
<dd><p>Optional NA flag for writing. Default <code>NULL</code> (omitted for Float32).</p></dd>


<dt id="arg-gdal-opts">gdal_opts<a class="anchor" aria-label="anchor" href="#arg-gdal-opts"></a></dt>
<dd><p>GDAL creation options (merged with tuned defaults).
Default <code>c("COMPRESS=LZW","TILED=YES","BIGTIFF=IF_SAFER","NUM_THREADS=ALL_CPUS","BLOCKXSIZE=256","BLOCKYSIZE=256")</code>.</p></dd>


<dt id="arg-write-datatype">write_datatype<a class="anchor" aria-label="anchor" href="#arg-write-datatype"></a></dt>
<dd><p>Terra datatype for writing. Default <code>NULL</code> will be coded as <code>"FLT4S"</code>.</p></dd>


<dt id="arg-terra-memfrac">terra_memfrac<a class="anchor" aria-label="anchor" href="#arg-terra-memfrac"></a></dt>
<dd><p><code>terraOptions(memfrac=...)</code>. Default <code>0.7</code>.</p></dd>


<dt id="arg-terra-tempdir">terra_tempdir<a class="anchor" aria-label="anchor" href="#arg-terra-tempdir"></a></dt>
<dd><p>Temp dir for terra ops. Default <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code>.</p></dd>


<dt id="arg-terra-todisk">terra_todisk<a class="anchor" aria-label="anchor" href="#arg-terra-todisk"></a></dt>
<dd><p>Logical or <code>NA</code>. If <code>TRUE</code>, prefer on-disk for heavy steps. Default <code>FALSE</code>.</p></dd>


<dt id="arg-force-gc">force_gc<a class="anchor" aria-label="anchor" href="#arg-force-gc"></a></dt>
<dd><p>Logical; call <code><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc()</a></code> at checkpoints. Default <code>FALSE</code>.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Suppress console prints. Default <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Invisibly, a list with:</p><ul><li><p><code>path</code> (output file),</p></li>
<li><p><code>n_sources</code> (number of source cells on input grid),</p></li>
<li><p><code>n_na_final</code> (internal NA count on template footprint),</p></li>
<li><p><code>min_dist</code>, <code>max_dist</code>,</p></li>
<li><p><code>elapsed_sec</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Preparation &amp; CRS:</strong> Prepare inputs with the function <code><a href="polygon2input.html">polygon2input()</a></code> and the
templates from https://zenodo.org/records/14497070 (download via the function
<code><a href="download_raster_templates.html">download_raster_templates()</a></code>). The function does <strong>not</strong> automatically reproject
to the 100 m template. It only warns if CRSs differ. For rare cases, set
<code>project_to_template_input = TRUE</code> and provide <code>template_input</code> (10 m) to reproject
the input once at the start. Distance is computed in the (possibly reprojected)
inputs map units.</p>
<p><strong>Selecting class values:</strong> <code>values_as_one</code> accepts any-length vector combining:</p><ul><li><p>numeric values (e.g., <code>500</code>, <code>c(610,620,630)</code>), and/or</p></li>
<li><p>range strings in interval notation with inclusive/exclusive bounds:
<code>"[400,600]"</code>, <code>"(400,600)"</code>, <code>"[400,600)"</code>, <code>"(400,600]"</code>.
Example: <code>c("[600,700)", "500")</code>. If <code>values_as_one</code> is <code>NULL</code>, <strong>non-NA</strong>
cells are considered sources.</p></li>
</ul><p><strong>Distance engine:</strong> Set <code>use_whitebox = TRUE</code> (default) to compute the distance with
<code><a href="https://whiteboxr.gishub.org/reference/wbt_euclidean_distance.html" class="external-link">whitebox::wbt_euclidean_distance()</a></code>; otherwise <code><a href="https://rspatial.github.io/terra/reference/distance.html" class="external-link">terra::distance()</a></code> is used.</p>
<p><strong>Auto alignment choice:</strong> If input distance grid and the 100 m template are
same-CRS, bounding boxes match, and the template resolution is an <strong>integer multiple</strong>
of the input resolution (e.g., 10 m to 100 m), the function uses
<code>terra::aggregate(..., fun=mean)</code> (fast), followed by a light
<code>resample(..., "near")</code> to lock onto the template grid. Otherwise, it falls back
to <code>terra::resample(..., method="mean")</code>.</p>
<p><strong>Masking:</strong> A single mask to <code>template_egv</code> is applied once <strong>after</strong> alignment
and <strong>before</strong> plotting/saving.</p>
<p><strong>Gap filling:</strong> If <code>fill_gaps = TRUE</code>, gaps (cells where output is <code>NA</code> but the
template is not) are filled via <code><a href="https://whiteboxr.gishub.org/reference/wbt_fill_missing_data.html" class="external-link">whitebox::wbt_fill_missing_data()</a></code> with IDW
weight <code>idw_weight</code>. If <code>filter_size</code> is <code>NULL</code>, the function uses
<code>2 * max_gap_width_cells</code>, with a <strong>minimum of 3</strong> (no max clamp). Whitebox
temporaries are written with <code>COMPRESS=NONE</code> for speed; the final GeoTIFF uses <code>gdal_opts</code>.</p>
<p><strong>Workflow</strong></p><ol><li><p>Load <code>input</code> and <code>template_egv</code>; optionally reproject <code>input</code> once if
<code>project_to_template_input=TRUE</code> (using <code>template_input</code>).</p></li>
<li><p>Build a <strong>seeds</strong> raster on the input grid: <code>1</code> where value matches <code>values_as_one</code>
(or non-<code>NA</code> if <code>values_as_one=NULL</code>), <code>NA</code> elsewhere.</p></li>
<li><p>Compute <strong>distance</strong> on the input grid via Whitebox (<code>wbt_euclidean_distance</code>) or
<code><a href="https://rspatial.github.io/terra/reference/distance.html" class="external-link">terra::distance()</a></code> depending on <code>use_whitebox</code>.</p></li>
<li><p><strong>Align</strong> the distance raster to the template:</p><ul><li><p>If perfectly nested (same CRS, matching extent, integer resolution ratio),
do <code>aggregate(mean)</code> then <code>resample("near")</code>.</p></li>
<li><p>Else if same CRS but not nested, <code>resample(method="mean")</code>.</p></li>
<li><p>Else, <code>project(..., method="bilinear")</code>.</p></li>
</ul></li>
<li><p>Apply a <strong>single final mask</strong> to <code>template_egv</code>.</p></li>
<li><p>Optionally <strong>fill gaps</strong> with Whitebox (if <code>fill_gaps=TRUE</code>) on the template grid.</p></li>
<li><p>Optionally <strong>plot</strong> result and/or gap map (side-by-side if both requested).</p></li>
<li><p><strong>Write atomically</strong> to GeoTIFF with LZW compression and tuned GDAL options.</p></li>
<li><p>Restore <code>terraOptions()</code> and sink state on exit (prevents stuck sinks).</p></li>
</ol><p>Console safety: uses <code><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat()</a></code> for progress and snapshots/restores sink state on exit
so your console will not remain "sunk" after interrupts.</p>
<p>[400,600)"<code>, </code>"(400,600]: R:400,600)%22%60,%20%60%22(400,600</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="polygon2input.html">polygon2input()</a></code> for preparing the input raster,
<code><a href="input2egv.html">input2egv()</a></code> for aggregation/resampling to the EGV grid,
<code><a href="downscale2egv.html">downscale2egv()</a></code>, <code><a href="landscape_function.html">landscape_function()</a></code>, <code><a href="radius_function.html">radius_function()</a></code>,
and the template downloaders: <code><a href="download_raster_templates.html">download_raster_templates()</a></code>, <code><a href="download_vector_templates.html">download_vector_templates()</a></code>.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Distance from classes 1 and [10,20) using Whitebox, with side-by-side plots</span></span></span>
<span class="r-in"><span><span class="fu">distance2egv</span><span class="op">(</span></span></span>
<span class="r-in"><span>  input         <span class="op">=</span> <span class="st">"./TestejuPakotni_early/Forests_StandAge_bg0_b.tif"</span>,</span></span>
<span class="r-in"><span>  template_egv  <span class="op">=</span> <span class="st">"./Templates/TemplateRasters/LV100m_10km.tif"</span>,</span></span>
<span class="r-in"><span>  values_as_one <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"[10,20)"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  outlocation   <span class="op">=</span> <span class="st">"./Rastri_100m/RAW/"</span>,</span></span>
<span class="r-in"><span>  outfilename   <span class="op">=</span> <span class="st">"dist_age_100m.tif"</span>,</span></span>
<span class="r-in"><span>  layername     <span class="op">=</span> <span class="st">"dist_age"</span>,</span></span>
<span class="r-in"><span>  use_whitebox  <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  plot_result   <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  plot_gaps     <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  terra_todisk  <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Same with terra::distance() and gap filling</span></span></span>
<span class="r-in"><span><span class="fu">distance2egv</span><span class="op">(</span></span></span>
<span class="r-in"><span>  input         <span class="op">=</span> <span class="st">"./Masks/roads_mask_10m.tif"</span>,</span></span>
<span class="r-in"><span>  template_egv  <span class="op">=</span> <span class="st">"./Templates/TemplateRasters/LV100m_10km.tif"</span>,</span></span>
<span class="r-in"><span>  values_as_one <span class="op">=</span> <span class="cn">NULL</span>,  <span class="co"># non-NA are sources</span></span></span>
<span class="r-in"><span>  use_whitebox  <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  fill_gaps     <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  idw_weight    <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  outlocation   <span class="op">=</span> <span class="st">"./Rastri_100m/RAW/"</span>,</span></span>
<span class="r-in"><span>  outfilename   <span class="op">=</span> <span class="st">"dist_roads_100m.tif"</span>,</span></span>
<span class="r-in"><span>  layername     <span class="op">=</span> <span class="st">"dist_roads"</span>,</span></span>
<span class="r-in"><span>  terra_todisk  <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andris Avotiņš.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>


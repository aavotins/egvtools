<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Rasterize polygons to a template grid, optionally restrict &amp; cover gaps, then write GeoTIFF — polygon2input • egvtools</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Rasterize polygons to a template grid, optionally restrict &amp; cover gaps, then write GeoTIFF — polygon2input"><meta name="description" content='Rasterizes polygon/multipolygon sf data to a raster aligned to a template GeoTIFF.
Rasterization targets a raster::RasterLayer built from the template (so grids normally match).
Projection is optional (project_mode). Missing values are counted only over valid template
cells. You may optionally restrict the result with a raster mask (restrict_to) using numeric
values or bracketed range strings (e.g., "(0,5]", "[10,)"). Remaining NA cells can be
filled by covering with a background raster (background_raster) or a constant (background_value).
For large rasters, heavy steps (projection/mask/cover) can stream to disk via terra_todisk=TRUE.'><meta property="og:description" content='Rasterizes polygon/multipolygon sf data to a raster aligned to a template GeoTIFF.
Rasterization targets a raster::RasterLayer built from the template (so grids normally match).
Projection is optional (project_mode). Missing values are counted only over valid template
cells. You may optionally restrict the result with a raster mask (restrict_to) using numeric
values or bracketed range strings (e.g., "(0,5]", "[10,)"). Remaining NA cells can be
filled by covering with a background raster (background_raster) or a constant (background_value).
For large rasters, heavy steps (projection/mask/cover) can stream to disk via terra_todisk=TRUE.'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">egvtools</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://github.com/aavotins/egvtools"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Rasterize polygons to a template grid, optionally restrict &amp; cover gaps, then write GeoTIFF</h1>
      <small class="dont-index">Source: <a href="https://github.com/aavotins/egvtools/blob/HEAD/R/polygon2input.R" class="external-link"><code>R/polygon2input.R</code></a></small>
      <div class="d-none name"><code>polygon2input.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Rasterizes polygon/multipolygon <strong>sf</strong> data to a raster aligned to a <strong>template</strong> GeoTIFF.
Rasterization targets a <code>raster::RasterLayer</code> built from the template (so grids normally match).
Projection is optional (<code>project_mode</code>). Missing values are counted <strong>only</strong> over valid template
cells. You may optionally restrict the result with a raster mask (<code>restrict_to</code>) using numeric
values or <strong>bracketed range strings</strong> (e.g., <code>"(0,5]"</code>, <code>"[10,)"</code>). Remaining <code>NA</code> cells can be
filled by covering with a background raster (<code>background_raster</code>) or a constant (<code>background_value</code>).
For large rasters, heavy steps (projection/mask/cover) can stream to disk via <code>terra_todisk=TRUE</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">polygon2input</span><span class="op">(</span></span>
<span>  <span class="va">vector_data</span>,</span>
<span>  <span class="va">template_path</span>,</span>
<span>  out_path <span class="op">=</span> <span class="st">"./"</span>,</span>
<span>  <span class="va">file_name</span>,</span>
<span>  value_field <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  constant_value <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  fun <span class="op">=</span> <span class="st">"max"</span>,</span>
<span>  value_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"categorical"</span>, <span class="st">"continuous"</span><span class="op">)</span>,</span>
<span>  project_mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"auto"</span>, <span class="st">"never"</span>, <span class="st">"always"</span><span class="op">)</span>,</span>
<span>  prepare <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  restrict_to <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  restrict_values <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  background_raster <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  background_value <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  check_na <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_result <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plot_gaps <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  NAflag <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  gdal_opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"COMPRESS=LZW"</span>, <span class="st">"TILED=YES"</span>, <span class="st">"BIGTIFF=IF_SAFER"</span>, <span class="st">"NUM_THREADS=ALL_CPUS"</span>,</span>
<span>    <span class="st">"BLOCKXSIZE=256"</span>, <span class="st">"BLOCKYSIZE=256"</span><span class="op">)</span>,</span>
<span>  write_datatype <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  terra_memfrac <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  terra_tempdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  terra_todisk <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  force_gc <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-vector-data">vector_data<a class="anchor" aria-label="anchor" href="#arg-vector-data"></a></dt>
<dd><p>sf polygons/multipolygons to rasterize.</p></dd>


<dt id="arg-template-path">template_path<a class="anchor" aria-label="anchor" href="#arg-template-path"></a></dt>
<dd><p>Path to the template raster (.tif).</p></dd>


<dt id="arg-out-path">out_path<a class="anchor" aria-label="anchor" href="#arg-out-path"></a></dt>
<dd><p>Output directory. Default <code>"./"</code>.</p></dd>


<dt id="arg-file-name">file_name<a class="anchor" aria-label="anchor" href="#arg-file-name"></a></dt>
<dd><p>Output filename, e.g., <code>"my_input.tif"</code>.</p></dd>


<dt id="arg-value-field">value_field<a class="anchor" aria-label="anchor" href="#arg-value-field"></a></dt>
<dd><p>Character or <code>NULL</code>. Attribute to burn; if <code>NULL</code>, uses <code>constant_value</code>.</p></dd>


<dt id="arg-constant-value">constant_value<a class="anchor" aria-label="anchor" href="#arg-constant-value"></a></dt>
<dd><p>Numeric scalar burned when <code>value_field=NULL</code>. Default <code>1</code>.</p></dd>


<dt id="arg-fun">fun<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p>Aggregation in <code>fasterize</code> for overlaps: one of <code>"max"</code>, <code>"sum"</code>, <code>"first"</code>, <code>"last"</code>, <code>"min"</code>, <code>"count"</code>.
Default <code>"max"</code>.</p></dd>


<dt id="arg-value-type">value_type<a class="anchor" aria-label="anchor" href="#arg-value-type"></a></dt>
<dd><p>Guides resampling <strong>if projection happens</strong>:
<code>"categorical"</code> with method <code>"near"</code>, <code>"continuous"</code> with <code>"bilinear"</code>. Default <code>"categorical"</code>.</p></dd>


<dt id="arg-project-mode">project_mode<a class="anchor" aria-label="anchor" href="#arg-project-mode"></a></dt>
<dd><p><code>"auto"</code> (default; project only if misaligned), <code>"never"</code>, or <code>"always"</code>.</p></dd>


<dt id="arg-prepare">prepare<a class="anchor" aria-label="anchor" href="#arg-prepare"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, run <code>st_make_valid()</code> and transform to template CRS. Default <code>TRUE</code>.</p></dd>


<dt id="arg-restrict-to">restrict_to<a class="anchor" aria-label="anchor" href="#arg-restrict-to"></a></dt>
<dd><p>Optional raster mask (path or <code>terra</code> <code>SpatRaster</code>).</p></dd>


<dt id="arg-restrict-values">restrict_values<a class="anchor" aria-label="anchor" href="#arg-restrict-values"></a></dt>
<dd><p>Optional values to keep from <code>restrict_to</code>: numbers (scalar/vector) and/or
<strong>range strings</strong> using bracket inclusivity, e.g. <code>"(0,5]"</code>, <code>"[10,)"</code>, <code>"(-inf,0)"</code>. Multiple entries are OR-ed.
If <code>NULL</code>, keep non-NA cells of <code>restrict_to</code>.</p></dd>


<dt id="arg-background-raster">background_raster<a class="anchor" aria-label="anchor" href="#arg-background-raster"></a></dt>
<dd><p>Optional path/<code>SpatRaster</code> used to cover remaining NAs.</p></dd>


<dt id="arg-background-value">background_value<a class="anchor" aria-label="anchor" href="#arg-background-value"></a></dt>
<dd><p>Numeric constant to fill where result is NA <strong>if</strong> no <code>background_raster</code>.
Default <code>NULL</code> (no covering).</p></dd>


<dt id="arg-check-na">check_na<a class="anchor" aria-label="anchor" href="#arg-check-na"></a></dt>
<dd><p>Logical. If <code>TRUE</code>, report NA counts before/after. Default <code>TRUE</code>.</p></dd>


<dt id="arg-plot-result">plot_result<a class="anchor" aria-label="anchor" href="#arg-plot-result"></a></dt>
<dd><p>Logical. Plot final raster (after all processing). Default <code>FALSE</code>.</p></dd>


<dt id="arg-plot-gaps">plot_gaps<a class="anchor" aria-label="anchor" href="#arg-plot-gaps"></a></dt>
<dd><p>Logical. Plot NA gaps (only within template footprint). If both plot flags are <code>TRUE</code>,
plots are side-by-side. Default <code>FALSE</code>.</p></dd>


<dt id="arg-naflag">NAflag<a class="anchor" aria-label="anchor" href="#arg-naflag"></a></dt>
<dd><p>Optional NA flag for writing (passed to GDAL). Default <code>NULL</code> (auto if needed).</p></dd>


<dt id="arg-gdal-opts">gdal_opts<a class="anchor" aria-label="anchor" href="#arg-gdal-opts"></a></dt>
<dd><p>Character vector of GDAL creation options (merged with tuned defaults).
Default <code>c("COMPRESS=LZW","TILED=YES","BIGTIFF=IF_SAFER","NUM_THREADS=ALL_CPUS","BLOCKXSIZE=256","BLOCKYSIZE=256")</code>.</p></dd>


<dt id="arg-write-datatype">write_datatype<a class="anchor" aria-label="anchor" href="#arg-write-datatype"></a></dt>
<dd><p>Optional terra datatype for writing (e.g., <code>"FLT4S"</code>, <code>"INT2S"</code>). Default <code>NULL</code> (auto).</p></dd>


<dt id="arg-terra-memfrac">terra_memfrac<a class="anchor" aria-label="anchor" href="#arg-terra-memfrac"></a></dt>
<dd><p><code>terraOptions(memfrac=...)</code>. Default <code>0.7</code>.</p></dd>


<dt id="arg-terra-tempdir">terra_tempdir<a class="anchor" aria-label="anchor" href="#arg-terra-tempdir"></a></dt>
<dd><p>Temp dir for terra operations. Default <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code>.</p></dd>


<dt id="arg-terra-todisk">terra_todisk<a class="anchor" aria-label="anchor" href="#arg-terra-todisk"></a></dt>
<dd><p>Logical or <code>NA</code>. If <code>TRUE</code>, prefer on-disk processing for heavy ops (project/mask/cover).
If <code>FALSE</code>, prefer memory. If <code>NA</code>, leave session default unchanged. Default <code>FALSE</code>.</p></dd>


<dt id="arg-force-gc">force_gc<a class="anchor" aria-label="anchor" href="#arg-force-gc"></a></dt>
<dd><p>Logical; call <code><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc()</a></code> at checkpoints. Default <code>FALSE</code>.</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>Overwrite output? Default <code>FALSE</code>.</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>Suppress progress prints (<code><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat()</a></code>)? Default <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Invisibly, a list with <code>out_file</code>, <code>n_cells</code>, <code>n_na_initial</code>, <code>n_na_final</code>, <code>elapsed_sec</code>, and <code>crs</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Workflow</strong></p><ol><li><p>(Optional) <code>prepare=TRUE</code> ensures valid polygons and transforms to the template CRS
(<code><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">sf::st_make_valid()</a></code> + <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">sf::st_transform()</a></code>). Set <code>prepare=FALSE</code> if you guarantee this.</p></li>
<li><p>Rasterize with <code><a href="https://rdrr.io/pkg/fasterize/man/fasterize.html" class="external-link">fasterize::fasterize()</a></code> onto a <code>raster::RasterLayer</code> built from the template.</p></li>
<li><p>Depending on <code>project_mode</code>, <strong>project</strong> to the template grid:</p><ul><li><p><code>"auto"</code> (default): checks CRS/resolution/extent/rows/cols; projects <strong>only if needed</strong>.</p></li>
<li><p><code>"never"</code>: skips projection.</p></li>
<li><p><code>"always"</code>: forces projection (<code>"near"</code> for <code>value_type="categorical"</code>, <code>"bilinear"</code> for <code>"continuous"</code>).</p></li>
</ul></li>
<li><p>Apply a <strong>template mask</strong> (keeps template extent and <code>NA</code> footprint).</p></li>
<li><p>(Optional) <strong>Restrict</strong> by <code>restrict_to</code> (path or in-memory <code>SpatRaster</code>):</p><ul><li><p>If <code>restrict_values</code> is <code>NULL</code>, keep <strong>non-NA</strong> cells of <code>restrict_to</code>.</p></li>
<li><p>If supplied, keep cells matching <strong>numbers</strong> (scalar/vector) and/or <strong>ranges</strong> using bracket
syntax: <code>"(a,b)"</code> open; <code>"[a,b]"</code> closed; mix ends like <code>"(a,b]"</code>. Use <code>-inf</code>/<code>+inf</code> for unbounded,
e.g., <code>"[10,)"</code>, <code>"(-inf,0)"</code>. Multiple entries are OR-ed.</p></li>
</ul></li>
<li><p>(Optional) <strong>Cover</strong> remaining <code>NA</code> cells:</p><ul><li><p>with <code>background_raster</code> (aligned to template; projected if needed), or</p></li>
<li><p>with a <strong>constant</strong> using <code>background_value</code> (fast and memory-light).</p></li>
</ul></li>
<li><p>A <strong>final mask</strong> to the template is applied <strong>before plotting and saving</strong>.</p></li>
<li><p>NA counts are computed with <code><a href="https://rspatial.github.io/terra/reference/global.html" class="external-link">terra::global()</a></code> on raster masks (memory-safe).</p></li>
</ol><p><strong>Datatype &amp; NAflag auto-chooser</strong>
If you do <strong>not</strong> provide <code>write_datatype</code>/<code>NAflag</code>, the function picks:</p><ul><li><p><code>value_type="categorical"</code> to <code>write_datatype="INT2S"</code>, <code>NAflag=-32768</code></p></li>
<li><p><code>value_type="continuous"</code> to <code>write_datatype="FLT4S"</code>, <code>NAflag</code> omitted
You can always override via arguments.</p></li>
</ul><p><strong>Performance &amp; stability</strong></p><ul><li><p>For very large rasters (e.g., ~1.3B cells), set <code>terra_todisk=TRUE</code> and consider a fast SSD for
<code>terra_tempdir</code>. This streams big operations to disk and avoids "vector memory limit" errors.</p></li>
<li><p>Projection is often unnecessary here because rasterization targets the template grid; <code>"auto"</code>
will detect alignment and skip it.</p></li>
<li><p>Writes are <strong>atomic</strong>: a temporary file is written and then moved into place.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="range-string-syntax-for-restrict-values">Range string syntax for restrict_values<a class="anchor" aria-label="anchor" href="#range-string-syntax-for-restrict-values"></a></h2>


<p>Use <code>(a,b)</code> for open interval, <code>[a,b]</code> for closed; mix ends like <code>(a,b]</code>. Use -inf/+inf (or inf)
for unbounded, e.g., "[10,)", "(-inf,0)". Supply multiple strings to OR them, e.g., c("(0,5]","[10,15)").</p>
<p>[10,)", "(-inf,0)". Supply multiple strings to OR them, e.g., c("(0,5]: R:10,)%22,%20%22(-inf,0)%22.%20Supply%20multiple%20strings%20to%20OR%20them,%20e.g.,%20c(%22(0,5</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="tiled_buffers.html">tiled_buffers()</a></code>, <code><a href="tile_vector_grid.html">tile_vector_grid()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>

    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Andris Avotiņš.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>


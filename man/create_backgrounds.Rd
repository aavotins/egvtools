% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/create_backgrounds.R
\name{create_backgrounds}
\alias{create_backgrounds}
\title{Create constant-background rasters from a directory of GeoTIFFs}
\usage{
create_backgrounds(
  in_dir,
  out_dir = NULL,
  background_value = 0,
  pattern = NULL,
  recursive = FALSE,
  out_prefix = NULL,
  NAflag = NULL,
  gdal_opts = c("COMPRESS=LZW", "TILED=YES", "BIGTIFF=IF_SAFER", "NUM_THREADS=ALL_CPUS",
    "BLOCKXSIZE=256", "BLOCKYSIZE=256"),
  write_datatype = NULL,
  terra_memfrac = 0.7,
  terra_tempdir = tempdir(),
  terra_todisk = FALSE,
  force_gc = FALSE,
  overwrite = FALSE,
  quiet = FALSE
)
}
\arguments{
\item{in_dir}{Directory containing input rasters.}

\item{out_dir}{Directory for outputs. If \code{NULL}, defaults to \code{file.path(in_dir,"backgrounds")}.}

\item{background_value}{Numeric value to assign to all non-NA pixels. Default \code{0}.}

\item{pattern}{Optional regex to filter filenames (applied after extension filter).}

\item{recursive}{Logical; search subdirectories in \code{in_dir}. Default \code{FALSE}.}

\item{out_prefix}{Optional filename prefix. If \code{NULL}, it defaults to:
\itemize{
\item \code{"nulls_"} when \code{background_value == 0},
\item otherwise \code{"bg[background_value]_"} (e.g., \code{"bg10_"}, \code{"bg0.5_"}).
}}

\item{NAflag}{Optional NA flag for writing (passed to GDAL). Default \code{NULL} (auto).}

\item{gdal_opts}{Character vector of GDAL creation options (merged with tuned defaults).
Default \code{c("COMPRESS=LZW","TILED=YES","BIGTIFF=IF_SAFER","NUM_THREADS=ALL_CPUS","BLOCKXSIZE=256","BLOCKYSIZE=256")}.}

\item{write_datatype}{Optional terra datatype for writing (e.g., \code{"INT2S"}, \code{"FLT4S"}).
Default \code{NULL} (auto as described above).}

\item{terra_memfrac}{\code{terraOptions(memfrac=...)}. Default \code{0.7}.}

\item{terra_tempdir}{Temp dir for terra operations. Default \code{tempdir()}.}

\item{terra_todisk}{Logical or \code{NA}. If \code{TRUE}, prefer on-disk processing for the
\code{ifel} step. Default \code{FALSE}.}

\item{force_gc}{Logical; call \code{gc()} at checkpoints. Default \code{FALSE}.}

\item{overwrite}{Overwrite existing outputs? Default \code{FALSE}.}

\item{quiet}{Suppress progress prints (\code{cat()})? Default \code{FALSE}.}
}
\value{
Invisibly, a data.frame with columns: \code{in_file}, \code{out_file}, \code{n_cells}, \code{elapsed_sec}.
}
\description{
For every raster in \code{in_dir}, creates a new raster where all \strong{non-NA} cells
are set to \code{background_value} and NA cells are preserved. Outputs go to \code{out_dir}
(created if needed). Files are named with a prefix (by default \code{nulls_} when
\code{background_value == 0}, otherwise \verb{bg[background_value]_}) followed by the
original name, e.g. \code{bg10_my.tif}. Uses LZW compression and atomic writes.
Large rasters can stream to disk with \code{terra_todisk=TRUE}.
}
\details{
\itemize{
\item Reads each input with \code{terra::rast()}.
\item Applies a fast element-wise replacement with \code{terra::ifel(!is.na(x), background_value, NA)}.
\item Writes with LZW compression to a temporary \code{._tmp.tif}, then atomically renames
to the final file.
\item If you do not set \code{write_datatype}/\code{NAflag}, the function picks sensible defaults:
\itemize{
\item If \code{background_value} is an integer and within \verb{[-32768, 32767]}, then \code{INT2S} + \code{NAflag=-32768}.
\item Otherwise \code{FLT4S} + float \code{NAflag} (\code{-3.4028235e38}).
}
\item Only \code{.tif} / \code{.tiff} files are processed (optionally refine with \code{pattern}).
}
}
\examples{
\dontrun{
# Classic "nulls_" backgrounds (fill 0)
create_backgrounds(
  in_dir = "./Templates/TemplateRasters",
  out_dir = "./Outputs/Nulls",
  background_value = 0,
  overwrite = TRUE,
  terra_todisk = TRUE
)

# Fill non-NA with 10, prefix becomes "bg10_"
create_backgrounds(
  in_dir = "./Templates/TemplateRasters",
  out_dir = "./Outputs/BG10",
  background_value = 10,
  overwrite = TRUE
)
}

}
